# === 电影世界规划 (Arc Planning) Prompts ===
MOVIE_SELECTION_PROMPT = """
你是一位恐怖电影大师。请为故事主角选择下一部要穿越的经典恐怖电影。
主角是一名普通人，没有超能力。请选择一个适合普通人生存挑战的电影。
请只返回电影的中文名称，不要添加任何解释。
"""

MOVIE_ANALYSIS_PROMPT = """
你是一位顶级的电影编剧和世界构建师。你将为小说的一个新篇章（大章节）做框架规划。
主角名叫**江浩**，是一名中国的**普通待业青年**，他将穿越到恐怖电影《{movie_name}》中。

你的任务是输出一个**JSON对象**，该对象包含完整的场景式剧情大纲。
你的输出**必须**是一个严格的、单一的、不包含任何额外解释或Markdown格式的JSON对象。

请遵循以下JSON结构：
{{
  "overall_setting": {{
    "protagonist_adaptation": "(请在此处填写：改编电影的核心情节，使其符合主角“江浩”的身份。为他被卷入核心事件设计一个原创且合理的动机。)",
    "horror_core": "(请在此处填写：电影的核心恐怖来源是什么？)",
    "scene_atmosphere": "(请在此处填写：描述这个世界的主要场景和整体氛围。)",
    "key_new_characters": [
      {{
        "name": "(NPC 1 姓名)",
        "personality": "(NPC 1 性格)",
        "function": "(NPC 1 在剧情中的具体作用)"
      }}
    ],
    "meta_narrative_foreshadowing": {{
        "content": "(请在此处构思一种方式，让角色偶尔能感觉到一种被无形之手操纵的诡异感。)",
        "trigger_scene": "(请在此处指定伏笔被揭示的**高潮场景编号**)"
    }}
  }},
  "scenes": [
    {{
      "scene_number": 1,
      "day": 1,
      "part_of_day": "白天",
      "subtitle": "(场景1的副标题/核心事件)",
      "synopsis": "(场景1的剧情梗概)",
      "character_perspective": "(提示在这些事件中，哪位角色的视点（POV）最能体现本章情绪，并简述其可能的反应或视角)",
      "emotion_anchor": "(场景1的核心情绪)"
    }}
  ]
}}

请为整个故事弧规划 10-15 个场景，并将它们填充到 "scenes" 数组中。确保JSON格式的完整性和正确性。
"""

ARCHITECT_REVIEW_PROMPT = """
你是一位经验丰富的总编。你的任务是审查以下新篇章的**整体剧情大纲** (JSON格式)，并从宏观角度提出修改意见。

**审查标准:**
1.  **叙事节奏与张弛感:** 整个大纲的节奏是否合理？情节是一味地紧张，还是有必要的“留白”（例如：短暂的安逸、角色间的温情互动）来调节情绪，做到张弛有度？
2.  **主角弧光:** 主角江浩（一个普通人）在这10-15个场景中是否有清晰的成长或转变？
3.  **情节逻辑:** 场景事件推进是否合乎逻辑？角色动机是否清晰？
4.  **创意与适配:** “主角适配”的设定是否巧妙？“元叙事伏笔”的设置和触发时机是否高明？

**剧情大纲初稿 (JSON):**
---
{movie_plan_draft}
---

请以客观、中立的第三方总编身份，输出一份简洁的、要点式的中文修改意见列表。
"""

ARCHITECT_REWRITE_PROMPT = """
你是一位顶级的电影编剧，正在根据总编的意见修改你的剧本大纲。
你的任务是重写以下JSON格式的剧情大纲，必须严格遵循并解决总编提出的所有宏观结构和节奏问题。

**原始大纲初稿 (JSON):**
---
{original_plan}
---

**总编的修改意见 (必须解决):**
---
{feedback}
---

请现在输出经过你精心打磨后的、**完整的、严格格式的全新JSON对象**。不要包含任何额外解释或Markdown标记。
"""


TOOL_CREATION_PROMPT = """
你是一位注重现实逻辑的道具设计师。主角（一名普通人）刚刚在恐怖电影《{movie_name}》的世界中成功存活下来。
根据规则，他可以带出一件具有纪念意义的**非超自然**工具。

你的任务是设计这件工具。请遵循以下严格规则：
1.  **绝对普通:** 工具不能是魔法物品或高科技产品。
2.  **功能合理:** 工具可以有巧妙的用途，但不能超出其物理限制。
3.  **来源合理:** 工具必须是电影《{movie_name}》世界中合乎逻辑存在的物品。

请返回一个JSON对象，格式如下：
{{
  "tool_name": "工具名称",
  "description": "对工具外观和来源的详细描述。",
  "potential_use": "在未来的恐怖世界中，这个普通工具可能发挥的创造性作用。"
}}
"""

# === 现实世界主线剧情 Prompts ===
REAL_WORLD_GENERATION_PROMPT = """
你是一位悬疑和都市传说小说家。主角刚刚从一个恐怖电影世界回归现实，带着新的经历和一件纪念品。
现实世界是故事的真正主线。主角的回归并非结束，而是新谜团的开始。

**背景资料:**
1.  **主角当前状态:** {real_world_summary}
2.  **主角携带的工具:** {protagonist_tools}

**写作要求:**
-   **核心任务:** 创作一章现实世界的主线剧情。这一章需要利用主角从上一个电影世界带回的工具或经历，揭示一个关于他自身或他所处现实的、更深层次的谜团，这个谜团可能与他**失业的背景或过去的经历**有关。
-   **推动主线:** 剧情必须向前推进，为主角下一次进入电影世界寻找答案或工具提供动机。
-   **风格:** 营造一种日常下的诡异与不安感。
-   **格式:** 请直接创作正文，不要添加任何评论。
"""

# === 章节生成与打磨 Prompts ===
FIRST_CHAPTER_PROMPT_TEMPLATE = """
你是一位才华横溢、写作风格细腻客观的中文小说家。你的任务是根据**预设的剧本**，完成小说中第一个场景的故事章节。主角是一名**普通人**。

**今日剧本 (必须严格遵守):**
1.  **本章主题 (副标题):** "{chapter_subtitle}"
2.  **核心情绪锚点:** "{emotional_anchor}"
3.  **世界观设定:** {movie_plan}

**写作要求:**
-   **核心任务：演绎剧本:** 你的写作必须完全服务于**今日剧本**。所有情节都必须围绕**副标题**展开，并且全力渲染出预设的**核心情绪锚点**。
-   **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
-   **开篇情节:** 故事从主角在一个无聊的下午观看电影《{movie_name}》，然后意外穿越到这个电影世界中开始。
-   **建立悬念与行动:** 让主角立即面临一个具体的、需要做出反应的小冲突或谜题，以此推动故事的第一个行动。
-   **注入内心驱动力:** 通过简短的内心独白、疑问或瞬间的权衡，来揭示主角**为什么**会做出这个决定。
-   **格式:** 请直接开始创作正文，不要添加任何评论。
"""

GENERATION_PROMPT_TEMPLATE = """
你是一位才华横溢、写作风格细腻客观的中文小说家。你的任务是根据**预设的剧本**，完成小说中一个场景的故事章节。主角是一名**普通人**。

**今日剧本 (必须严格遵守):**
1.  **本章主题 (副标题):** "{chapter_subtitle}"
2.  **核心情绪锚点:** "{emotional_anchor}"
3.  **世界观设定:** {movie_plan}

**其他背景资料:**
4.  **故事摘要:** "{summary_text}"
5.  **本章出场人物侧写:**
{character_profiles_text}
6.  **主角携带的工具:** {protagonist_tools}

**写作要求:**
-   **核心任务：演绎剧本:** 你的写作必须完全服务于**今日剧本**。所有情节、发现和角色互动都必须围绕**副标题**展开，并且全力渲染出预设的**核心情绪锚点**。
-   **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
-   **角色互动与功能:** 重点描写角色之间的互动。确保每个角色的行为和对话都符合他们在世界观设定中的**具体作用**。
-   **注入内心驱动力:** 在描述角色的行动时，通过简短的内心独白、疑问或权衡，来揭示他们**为什么**会做出这个决定。
-   **叙事视点:** 请严格根据以上背景资料，从角色“{character_pov}”的视点续写。
-   **格式:** 请直接开始创作，不要重复摘要或添加任何评论。
"""

REVIEW_PROMPT_TEMPLATE = """
你是一位极其严苛的文学编辑。你的任务是审查以下小说章节的初稿，并提出尖锐、具体、可操作的修改意见。

**本章剧本 (必须遵守):**
1.  **世界观设定:** {movie_plan}
2.  **本章主题 (副标题):** "{chapter_subtitle}"
3.  **核心情绪锚点:** "{emotional_anchor}"

**审查标准:**
1.  **剧本吻合度:** 章节内容是否紧扣**副标题**？是否成功营造了预设的**核心情绪锚点**？
2.  **世界观一致性:** 内容是否严格遵循了世界观设定？
3.  **情节推进:** 故事的核心情节是否向前发展了？还是角色在原地踏步？
4.  **思行平衡:** 角色的内心思考和外部行动是否平衡？
5.  **内容重复:** 是否有重复的句子、描述或感受？

**章节初稿:**
---
{chapter_text}
---

请以客观、中立的第三方编辑身份，输出一份简洁的、要点式的中文修改意见列表。不要使用“我”或“我们”等第一人称代词。
"""

REWRITE_PROMPT_TEMPLATE = """
你是一位顶级的小说家，正在根据编辑的意见修改自己的作品。
你的任务是重写以下章节，必须严格遵循并解决编辑提出的所有修改意见，同时保留故事的核心情节和所有原始背景设定。

**原始背景资料 (不可更改):**
1.  **今日剧本:**
    * **主题 (副标题):** "{chapter_subtitle}"
    * **核心情绪锚点:** "{emotional_anchor}"
    * **世界观设定:** {movie_plan}
2.  **其他背景:**
    * **故事摘要:** "{summary_text}"
    * **本章出场人物侧写:** {character_profiles_text}
    * **主角携带的工具:** {protagonist_tools}
    * **叙事视点:** {character_pov}

**章节初稿:**
---
{original_text}
---

**编辑的修改意见 (必须解决):**
---
{feedback}
---

请现在输出经过你精心打磨后的、全新的章节正文。不要包含任何解释。
"""

# === 其他 Prompts ===
SUMMARY_PROMPT_TEMPLATE = f"""
作为一名专业的故事分析师，你的任务是为以下文本创作一份简洁、**面向未来**的摘要。

**写作要求:**
1.  **聚焦核心冲突与悬念:** 摘要的核心内容应该是**当前尚未解决的关键冲突、新出现的谜团，以及主角面临的最紧迫的困境**。
2.  **明确角色的下一步动机:** 明确指出主角或关键人物接下来最可能的目标或行动方向。
3.  **摒弃旧信息:** 不要重复读者已经熟知的背景故事或人物关系，除非它们与当前的核心冲突直接相关。
4.  **长度:** 摘要长度应约为 300 字。

这是需要总结的文本：
---
{{story_text}}
---
你的中文精炼摘要：
"""

CHARACTER_IDENTIFICATION_PROMPT = """
你是一位敏锐的文学评论家。请仔细阅读以下故事摘要，并列出其中提及或暗示将要出现的**所有**主要角色的名字。
请只返回用逗号分隔的角色名列表（例如：张三,李四,王五），不要添加任何其他解释。如果不存在明确角色，请返回“无”。

故事摘要：
"{summary_text}"

角色名列表：
"""

POV_DECISION_PROMPT = """
你是一位经验丰富的编辑。你的任务是为下一章选择最佳的叙事视点（POV）。

**背景资料:**
1.  **故事摘要:** "{summary_text}"
2.  **编剧建议:** "{architect_suggestion}"

**任务要求:**
-   根据以上信息，决定最能推动剧情、最大化戏剧冲突的角色。
-   为了更好地从外部刻画故事和主角，请考虑在约20-30%的场景中选择配角作为视点。
-   请只返回一个角色的中文名字，不要添加任何解释。如果时机不合适，请返回“旁白”。

下一章的叙事视点角色名：
"""

PROFILE_UPDATE_PROMPT = """
你是一位深刻的心理分析师。请以客观、专业的口吻更新角色“{character_name}”的侧写档案。主角的成长被严格限制在普通人范围内。

**核心任务:**
1.  **分析当前行为:** 基于角色的旧档案和新章节内容，分析他/她的最新行为和心理变化。
2.  **背景慢速揭示 (仅限主角):** 如果角色是主角，请寻找机会，通过他在电影世界中的内心思考（例如，他对某个事件的联想、他对自身处境的反思），**极其缓慢且隐晦地**补充一小部分关于他现实世界背景的细节（如他过去的职业、人际关系或导致他失业的原因）。**切记：速度必须非常慢**，每一次只透露一丁点信息，为现实世界的主线剧情保留足够的悬念。
3.  **生成新档案:** 输出一份全新的档案，包含对以下几点的认知和评判：
    * 对自己的看法（作为普通人的能力、动机、恐惧、目标）。
    * 对其他关键角色的具体行为和事件的看法。
    * 对当前所处环境和近期发生的关键事件的理解与评判。

[旧的侧写档案内容开始]
{existing_profile}
[旧的侧写档案内容结束]

[最新章节内容（从此角色视点）开始]
{new_content}
[最新章节内容（从此角色视点）结束]

请输出完整、更新后的角色“{character_name}”的Markdown格式侧写档案。
"""

