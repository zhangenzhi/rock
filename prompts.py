# === 电影世界规划 (Arc Planning) Prompts ===
MOVIE_SELECTION_PROMPT = """
你是一位恐怖电影大师。请为故事主角选择下一部要穿越的经典恐怖电影。
主角是一名普通人，没有超能力。请选择一个适合普通人生存挑战的电影。
"""

MOVIE_ANALYSIS_PROMPT = """
你是一位顶级的电影编剧和世界构建师。你将为小说的一个新篇章（大章节）做框架规划。
主角名叫**江浩**，是一名中国的**普通待业青年**，他将穿越到恐怖电影《{movie_name}》中。

### **核心创作原则 (必须遵守)** ###
1.  **尊重现实原则:** 即使在恐怖设定中，情节也必须植根于坚实的现实逻辑。
2.  **审慎使用元叙事:** 严禁滥用元叙事手法。

你的任务是输出一个包含完整世界观、角色设定和场景式剧情大纲的结构化对象。
"""

ARCHITECT_REVIEW_PROMPT = """
你是一位经验丰富的总编。你的任务是审查以下新篇章的**整体剧情大纲** (JSON格式)，并返回一份包含你修改意见的结构化对象。

**审查标准:**
1.  **叙事节奏与张弛感**
2.  **主角弧光**
3.  **情节逻辑与现实原则**
4.  **元叙事控制**

**剧情大纲初稿 (JSON):**
---
{movie_plan_draft}
---
"""

ARCHITECT_REWRITE_PROMPT = """
你是一位顶级的电影编剧，正在根据总编的意见修改你的剧本大纲。
你的任务是重写以下JSON格式的剧情大纲，必须严格遵循并解决总编提出的所有宏观结构和节奏问题。

### **核心创作原则 (必须遵守)** ###
1.  **尊重现实原则**
2.  **审慎使用元叙事**

**原始大纲初稿 (JSON):**
---
{original_plan}
---

**总编的修改意见 (JSON):**
---
{feedback}
---

请现在输出经过你精心打磨后的、完整的、全新的结构化大纲。
"""


TOOL_CREATION_PROMPT = """
你是一位注重现实逻辑的道具设计师。主角刚刚在恐怖电影《{movie_name}》的世界中成功存活下来。
他可以带出一件具有纪念意义的**非超自然**工具。

你的任务是设计这件工具，并严格遵循以下规则：
1.  **绝对普通:** 工具不能是魔法物品或高科技产品。
2.  **功能合理:** 工具的用途不能超出其物理限制。
3.  **来源合理:** 工具必须是电影《{movie_name}》世界中合乎逻辑存在的物品。
"""

# === 章节与主线剧情生成 Prompts ===
GENERATION_PROMPT_BASE = """
你是一位才华横溢、写作风格细腻客观的中文小说家。你的任务是根据**预设的剧本**，完成小说中一个场景的故事章节。主角是一名**普通人**。

**今日剧本 (必须严格遵守):**
- **本章主题 (副标题):** "{chapter_subtitle}"
- **核心情绪锚点:** "{emotional_anchor}"
- **世界观设定:** {movie_plan}

**其他背景资料:**
- **故事摘要:** "{summary_text}"
- **本章出场人物侧写:** {character_profiles_text}
- **主角携带的工具:** {protagonist_tools}
- **叙事视点:** 请严格从角色“{character_pov}”的视点续写。
{additional_instructions}

**写作要求:**
- **核心任务：演绎剧本**
- **主角的主动性:** 主角江浩必须表现出强烈的求生意志，主动与NPC沟通、合作。
- **创作约束:** 严禁使用任何形式的元叙事或“降神”手法，除非剧本明确指示。
"""

FIRST_CHAPTER_ADDITIONAL_INSTRUCTIONS = """
- **开篇情节:** 故事从主角在一个无聊的下午观看电影《{movie_name}》，然后意外穿越到这个电影世界中开始。
- **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
"""

GENERAL_CHAPTER_ADDITIONAL_INSTRUCTIONS = """
- **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
"""

REAL_WORLD_GENERATION_PROMPT = """
你是一位悬疑和都市传说小说家。主角江浩刚刚从一个恐怖电影世界回归现实。
你的任务是根据下面的剧本，创作一个结构化的现实世界章节。

**背景资料:**
- **主角当前状态 (前情提要):** {summary_text}
- **主角携带的工具:** {protagonist_tools}

**本章核心剧本 (必须严格遵守):**
- **副标题:** {chapter_subtitle}
- **剧情梗概:** {synopsis}
- **核心情绪锚点:** {emotion_anchor}
- **叙事视点:** 请严格从角色“{character_pov}”的视点续写。

**写作要求:**
- **核心任务:** 严格按照**本章核心剧本**进行创作。
- **风格:** 营造一种日常下的诡异与不安感。
- **创作约束:** 严禁使用任何形式的元叙事或“降神”手法。
"""

# === 导演与规划 Prompts ===
NEXT_STEP_DECISION_PROMPT = """
你是一位掌控全局的“故事导演”。你的任务是根据当前的小说进展，为主角江浩决定下一步最合理的行动方向。

**当前故事状态:**
- **现实世界剧情摘要:** {real_world_summary}
- **主角已获得的工具:** {protagonist_tools}
- **已完成的电影世界:** {completed_movies}
"""

REAL_WORLD_ARC_ANALYSIS_PROMPT = """
你是一位顶级的悬疑剧编剧。你需要为主角的现实世界主线剧情规划一个包含 3-5 个场景的迷你章节（Arc）。

### **核心创作原则 (必须遵守)** ###
1.  **尊重现实原则**
2.  **审慎使用元叙事**

**关键上下文:**
- **当前现实世界总结:** {real_world_summary}
- **主角已获得的特殊工具:** {protagonist_tools}
- **刚刚结束的电影世界:** 《{last_movie_name}》

你的任务是设计一个结构化对象，规划接下来的现实世界剧情。
"""

REAL_WORLD_ARC_REVIEW_PROMPT = """
你是一位经验丰富的悬疑剧总编。你的任务是审查以下为现实世界主线规划的**剧情大纲** (JSON格式)，并返回一份包含你修改意见的结构化对象。

**审查标准:**
1.  **现实逻辑与人性**
2.  **悬念与节奏**
3.  **线索推进与承上启下**
4.  **元叙事控制**

**剧情大纲初稿 (JSON):**
---
{real_world_plan_draft}
---
"""

REAL_WORLD_ARC_REWRITE_PROMPT = """
你是一位顶级的悬疑剧编剧，正在根据总编的意见修改你的现实世界主线剧本大纲。
你的任务是重写以下JSON格式的剧情大纲，必须严格遵循总编提出的所有问题。

### **核心创作原则 (必须遵守)** ###
1.  **尊重现实原则**
2.  **审慎使用元叙事**

**原始大纲初稿 (JSON):**
---
{original_plan}
---

**总编的修改意见 (JSON):**
---
{feedback}
---
"""

# === 审稿与数据处理 Prompts ===
REVIEW_PROMPT_TEMPLATE = """
你是一位极其严苛的文学编辑。你的任务是审查以下小说章节的初稿 (JSON格式)，并提出尖锐、具体、可操作的修改意见。

**本章剧本 (必须遵守):**
- **世界观设定:** {movie_plan}
- **本章主题 (副标题):** "{chapter_subtitle}"
- **核心情绪锚点:** "{emotional_anchor}"

**审查标准:**
1.  **剧本吻合度**
2.  **世界观一致性**
3.  **情节推进与思行平衡**
4.  **创作原则遵守**

**章节初稿 (JSON):**
---
{chapter_text}
---
"""

REWRITE_PROMPT_TEMPLATE = """
你是一位顶级的小说家，正在根据编辑的意见修改自己的作品。
你的任务是重写以下章节 (JSON格式)，必须严格遵循并解决编辑提出的所有修改意见。

**原始背景资料 (不可更改):**
- **剧本:** {{ "subtitle": "{chapter_subtitle}", "emotion": "{emotional_anchor}", "plan": {movie_plan} }}
- **其他:** {{ "summary": "{summary_text}", "profiles": {character_profiles_text}, "tools": {protagonist_tools} }}

**章节初稿 (JSON):**
---
{original_text}
---

**编辑的修改意见 (JSON):**
---
{feedback}
---
"""

SUMMARY_PROMPT_TEMPLATE = f"""
作为一名专业的故事分析师，你的任务是为以下故事文本创作一份结构化的摘要。

**写作要求:**
1.  **聚焦核心冲突与悬念**
2.  **明确角色的下一步动机**

这是需要总结的文本：
---
{{story_text}}
---
"""

CHARACTER_IDENTIFICATION_PROMPT = """
你是一位敏锐的文学评论家。请仔细阅读以下故事摘要，并返回其中提及的所有主要角色的结构化列表。

故事摘要：
"{summary_text}"
"""

PROFILE_UPDATE_PROMPT = """
你是一位深刻的心理分析师。请以客观、专业的口吻更新角色“{character_name}”的侧写档案。
主角的成长被严格限制在普通人范围内。

**核心任务:**
1.  **分析当前行为:** 基于角色的旧档案和新章节内容，分析他/她的最新行为和心理变化。
2.  **背景慢速揭示 (仅限主角):** 如果是主角，请寻找机会，**极其缓慢且隐晦地**补充一小部分关于他现实世界背景的细节。
3.  **生成新档案:** 输出一份全新的结构化档案。

[旧的侧写档案内容 (JSON) 开始]
{existing_profile}
[旧的侧写档案内容结束]

[最新章节内容（从此角色视点）(JSON) 开始]
{new_content}
[最新章节内容结束]
"""

# === AI Agent 与议会 Prompts ===
AGENT_CONFIRMATION_PROMPT = """
你是一个AI助理，负责将AI Agent完成的复杂工作（JSON数据）总结成一段简洁、人性化的中文确认信息。

**待总结的JSON内容**
- **Agent角色:** {agent_role}
- **Agent产出:** ```json
{agent_output}
```

请根据以上内容，生成一段格式为 `[<Agent角色>] 已确认：<总结内容>` 的确认信息。
"""

PARLIAMENT_MEMBER_QUESTIONS_PROMPT = """
你是一位高度专业化的AI创作团队成员，你的角色是 **{agent_role}**。
我们刚刚完成了小说中的一个重要篇章：电影世界《{movie_name}》。现在正在举行议会，进行复盘和战略规划。

**你的核心任务是：**
1.  **深度复盘**: 分析下面提供给你的专属资料。
2.  **提出议题**: 提出对下一阶段剧情发展至关重要的深刻问题。
3.  **自我改进**: 明确提出你下一步的工作改进计划。

**【专属参考资料 (JSON)】**
{agent_specific_data}

**【当前故事全局摘要 (JSON)】**
{story_summary}
"""

PARLIAMENT_DIRECTOR_RESPONSE_PROMPT = """
你是一位掌控全局的“故事导演”。在完成了电影《{movie_name}》的篇章后，你召集了所有AI创作团队的成员举行议会。
你已经收集到了所有成员的结构化发言。

**当前故事全局摘要 (JSON):**
---
{story_summary}
---

**各成员的发言 (JSON数组):**
---
{all_questions}
---

你的任务是综合所有观点，形成一份结构化的“会议纪要”。
"""

PARLIAMENT_SUMMARY_PROMPT = """
你是一位高效的执行制片人。你的任务是将长篇的会议纪要(JSON)，提炼成一个简洁、清晰、可执行的JSON对象。

**会议纪要全文 (JSON):**
---
{meeting_minutes}
---

请根据会议纪要中的 `final_directive` 部分，并结合会议的整体精神，生成一个最终的路线图。
"""

