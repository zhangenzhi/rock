# === 电影世界规划 (Arc Planning) Prompts ===
MOVIE_SELECTION_PROMPT = """
你是一位恐怖电影大师，深谙如何为普通人营造极限生存挑战。
请为故事主角江浩（一名无超能力的普通人）选择下一部要穿越的经典恐怖电影。
选择时需考虑主角的情况，以及情节是否能提供足够的“爽点”。
"""

MOVIE_ANALYSIS_PROMPT = """
你是一位顶级的电影编剧和世界构建师，正在为小说的新篇章做框架规划。
主角名叫**江浩**，是一名中国的**普通待业青年**，他将穿越到恐怖电影《{movie_name}》中。
注意穿越的方式总是转场一样将主角掷入电影世界，带来荒诞感。

你的核心任务是，遵循“创作总纲”中的原则，为这个篇章设计一个包含完整世界观、角色设定和场景式剧情大纲的框架。
请为整个故事弧规划 10-15 个场景，确保叙事节奏张弛有度，并为主角提供清晰的推动路线弧光。

你必须严格遵循提供的JSON Schema来构建你的输出。
"""

ARCHITECT_REVIEW_PROMPT = """
你是一位经验丰富的总编，正在审查新篇章的剧情大纲。

**你的审查标准严格遵循“创作总纲”，并聚焦于以下几点:**
1.  **叙事节奏与张弛感:** 整个大纲的节奏是否合理？情节是一味地紧张，还是有必要的“留白”（例如：短暂的安逸、角色间的温情互动）来调节情绪？
2.  **主角弧光:** 主角江浩（一个普通人）在这10-15个场景中是否能够保持有一致性同时能够推动剧情？
3.  **情节逻辑与爽点:** 场景事件推进是否合乎逻辑？角色动机是否清晰？剧情设置是否能有效激发读者的阅读爽点？
4.  **创意与适配:** “主角适配”的设定是否巧妙？“元叙事伏笔”的设置和触发时机是否足够隐晦和高明？注意保持幽默。

请基于以上标准，对以下大纲提出你简洁、要点式的修改意见。

**待审查的大纲 (JSON):**
---
{movie_plan_draft}
---
"""

ARCHITECT_REWRITE_PROMPT = """
你是一位顶级的电影编剧，正在根据总编的意见修改你的剧本大纲。
你的任务是重写剧情大纲，必须严格遵循并解决总编提出的所有问题。

**原始大纲 (JSON):**
---
{original_plan}
---

**总编的修改意见 (JSON):**
---
{feedback}
---
"""


TOOL_CREATION_PROMPT = """
你是一位注重现实逻辑的道具设计师。主角江浩刚刚在恐怖电影《{movie_name}》的世界中成功存活。
根据规则，他可以带出一件具有纪念意义的**非超自然**工具。

**你的设计必须遵循以下严格规则：**
1.  **绝对普通:** 工具不能是魔法物品或高科技产品。
2.  **功能合理:** 工具可以有巧妙的用途，但不能超出其物理限制。
3.  **来源合理:** 工具必须是电影《{movie_name}》世界中合乎逻辑存在的物品。
4.  **关联性**: 工具的设计应巧妙，最好能与主角在现实世界中面临的谜团产生某种潜在的、意想不到的联系，以推动主线剧情。
"""

# === 现实世界主线剧情 Prompts ===
REAL_WORLD_GENERATION_PROMPT = """
你是一位悬疑和都市传说小说家。主角江浩刚刚从一个恐怖电影世界回归现实。
现实世界是故事的真正主线，主角的回归并非结束，而是新谜团的开始。

**你的核心任务是，严格按照以下“本章核心剧本”进行创作，营造一种日常下的诡异与不安感，并为主角的下一步行动提供明确的动机。**

**本章核心剧本:**
- **主角当前状态 (前情提要):** {summary_text}
- **主角携带的工具:** {protagonist_tools}
- **副标题:** {chapter_subtitle}
- **剧情梗概:** {synopsis}
- **核心情绪锚点:** {emotion_anchor}
- **叙事视点:** {character_pov}
"""

# === 故事导演决策 Prompt ===
NEXT_STEP_DECISION_PROMPT = """
你是一位掌控全局的“故事导演”，任务是为主角江浩决定下一步最合理的行动方向。

**当前故事状态:**
- **现实世界剧情摘要:** {real_world_summary}
- **主角已获得的工具:** {protagonist_tools}
- **已完成的电影世界:** {completed_movies}

**你的决策任务是，** 根据当前状态，判断下一步剧情走向是应该深入**现实世界 (`REAL_WORLD`)** 的谜团，还是进入一个新的**电影世界 (`MOVIE_WORLD`)** 去寻找特定线索或答案。
"""

# === 现实世界主线规划与审查 Prompts ===
REAL_WORLD_ARC_ANALYSIS_PROMPT = """
你是一位顶级的悬疑剧编剧和世界构建师。你需要为主角江浩的现实世界主线剧情规划一个包含 3-5 个场景的迷你章节。

**规划前，你必须首先在脑中构建一份详细的“现实世界背景侧写”，基于以下信息：**
- **核心设定：** 主角江浩是一名生活在中国、符合当代社会文化属性的普通待业青年。他的反应和困境必须真实可信。
- **已有信息：** 从 {real_world_summary} 和所有之前的章节内容中，提炼所有关于现实世界的细节。

**你的任务是，基于背景侧写，设计一个专注于挖掘线索、深化角色关系并制造悬念的剧情弧。**

**关键上下文:**
- **当前现实世界总结:** {real_world_summary}
- **主角已获得的工具:** {protagonist_tools}
- **刚刚结束的电影:** 《{last_movie_name}》
"""

REAL_WORLD_ARC_REVIEW_PROMPT = """
你是一位经验丰富的悬疑剧总编，任务是审查以下为现实世界主线规划的剧情大纲。

**审查标准:**
1.  **现实逻辑与人性:** 情节发展是否符合主角作为“当代中国普通失业青年”的背景设定？角色的动机和反应是否真实可信？
2.  **悬念与节奏:** 整个迷你章节的悬念设置是否巧妙？节奏是否张弛有度？
3.  **线索推进:** 剧情是否有效地利用了主角从电影世界带回的线索，并为主线谜团提供了有价值的推进？
4.  **承上启下:** 这个章节是否能自然地引出主角下一次进入电影世界的动机？

**待审查的大纲 (JSON):**
---
{real_world_plan_draft}
---
"""

REAL_WORLD_ARC_REWRITE_PROMPT = """
你是一位顶级的悬疑剧编剧，正在根据总编的意见修改你的现实世界主线剧本大纲。
你的任务是重写剧情大纲，必须严格遵循并解决总编提出的所有宏观结构和逻辑问题。

**原始大纲 (JSON):**
---
{original_plan}
---

**总编的修改意见 (JSON):**
---
{feedback}
---
"""

# === 章节生成与打磨 Prompts ===
FIRST_CHAPTER_PROMPT_TEMPLATE = """
你是一位才华横溢、写作风格细腻客观的中文小说家。你的任务是根据**预设的剧本**，完成小说中第一个场景的故事章节。主角是一名**普通人**。

**今日剧本 (必须严格遵守):**
1.  **本章主题 (副标题):** "{chapter_subtitle}"
2.  **核心情绪锚点:** "{emotional_anchor}"
3.  **世界观设定:** {movie_plan}

**写作要求:**
-   **核心任务：演绎剧本:** 你的写作必须完全服务于**今日剧本**。所有情节都必须围绕**副标题**展开，并且全力渲染出预设的**核心情绪锚点**。
-   **移动端优化:** 为了适应手机屏幕阅读，请使用更短的段落，并在适当的地方增加换行，避免出现大段的文字墙。
-   **主角的主动性:** 主角江浩必须表现出强烈的求生意志，主动与NPC进行沟通、制定计划、尝试合作以摆脱困境。即使合作因元叙事限制而最终失败，其尝试的过程也必须被详细描写。
-   **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
-   **开篇情节:** 故事从主角在一个无聊的下午观看电影《{movie_name}》，然后意外穿越到这个电影世界中开始。
-   **建立悬念与行动:** 让主角立即面临一个具体的、需要做出反应的小冲突或谜题，以此推动故事的第一个行动。
-   **注入内心驱动力:** 通过简短的内心独白、疑问或瞬间的权衡，来揭示主角**为什么**会做出这个决定。
"""

GENERATION_PROMPT_TEMPLATE = """
你是一位才华横溢、写作风格细腻客观的中文小说家。你的任务是根据**预设的剧本**，完成小说中一个场景的故事章节。主角是一名**普通人**。

**今日剧本 (必须严格遵守):**
1.  **本章主题 (副标题):** "{chapter_subtitle}"
2.  **核心情绪锚点:** "{emotional_anchor}"
3.  **世界观设定:** {movie_plan}

**其他背景资料:**
4.  **故事摘要:** "{summary_text}"
5.  **本章出场人物侧写:** {character_profiles_text}
6.  **主角携带的工具:** {protagonist_tools}

**写作要求:**
-   **核心任务：演绎剧本:** 你的写作必须完全服务于**今日剧本**。所有情节、发现和角色互动都必须围绕**副标题**展开，并且全力渲染出预设的**核心情绪锚点**。
-   **移动端优化:** 为了适应手机屏幕阅读，请使用更短的段落，并在适当的地方增加换行，避免出现大段的文字墙。
-   **主角的主动性:** 主角江浩必须表现出强烈的求生意志，主动与NPC进行沟通、制定计划、尝试合作以摆脱困境。即使合作因元叙事限制而最终失败，其尝试的过程也必须被详细描写。
-   **演绎元叙事感 (如果适用):** {meta_narrative_instruction}
-   **角色互动与功能:** 重点描写角色之间的互动。确保每个角色的行为和对话都符合他们在世界观设定中的**具体作用**。
-   **注入内心驱动力:** 在描述角色的行动时，通过简短的内心独白、疑问或权衡，来揭示他们**为什么**会做出这个决定。
-   **叙事视点:** 请严格根据以上背景资料，从角色“{character_pov}”的视点续写。
"""

REVIEW_PROMPT_TEMPLATE = """
你是一位极其严苛的文学编辑，任务是审查以下小说章节的初稿。

**审查标准:**
1.  **剧本吻合度:** 章节内容是否紧扣**副标题**？是否成功营造了预设的**核心情绪锚点**？
2.  **可读性与格式:** 文本是否遵循了移动端优化的原则（短段落、适当换行）？
3.  **情节推进:** 故事的核心情节是否向前发展了？
4.  **思行平衡:** 角色的内心思考和外部行动是否平衡？

**本章剧本:**
- **世界观设定:** {movie_plan}
- **主题 (副标题):** {chapter_subtitle}
- **核心情绪锚点:** {emotional_anchor}

**章节初稿 (JSON):**
---
{chapter_text}
---
"""

REWRITE_PROMPT_TEMPLATE = """
你是一位顶级的小说家，正在根据编辑的意见修改自己的作品。
你的任务是重写以下章节，必须严格遵循并解决编辑提出的所有修改意见，同时保留故事的核心情节和所有原始背景设定。

**原始背景资料 (不可更改):**
- **主题 (副标题):** {chapter_subtitle}
- **核心情绪锚点:** {emotional_anchor}
- **世界观设定:** {movie_plan}
- **故事摘要:** {summary_text}
- **本章出场人物侧写:** {character_profiles_text}
- **主角携带的工具:** {protagonist_tools}
- **叙事视点:** {character_pov}

**章节初稿 (JSON):**
---
{original_text}
---

**编辑的修改意见 (JSON):**
---
{feedback}
---
"""

# === 其他 Prompts ===
SUMMARY_PROMPT_TEMPLATE = """
作为一名专业的故事分析师，你的任务是为以下文本创作一份简洁的、**面向未来**的摘要。

**写作要求:**
1.  **聚焦核心冲突与悬念:** 摘要的核心内容应该是**当前尚未解决的关键冲突、新出现的谜团，以及主角面临的最紧迫的困境**。
2.  **明确角色的下一步动机:** 明确指出主角或关键人物接下来最可能的目标或行动方向。
"""

CHARACTER_IDENTIFICATION_PROMPT = """
你是一位敏锐的文学评论家。请仔细阅读以下故事摘要，并列出其中提及或暗示将要出现的**所有**主要角色的名字。

**故事摘要:**
"{summary_text}"
"""

PROFILE_UPDATE_PROMPT = """
你是一位深刻的心理分析师，任务是更新角色“{character_name}”的侧写档案。

**核心任务:**
1.  **分析当前行为:** 基于角色的旧档案和新章节内容，分析他/她的最新行为和心理变化。
2.  **背景慢速揭示 (仅限主角):** 如果角色是主角，请寻找机会，通过他在电影世界中的内心思考，**极其缓慢且隐晦地**补充一小部分关于他现实世界背景的细节。
3.  **生成新档案:** 输出一份全新的档案，包含对角色**自己的看法**、对**其他角色的看法**、以及对**近期关键事件的理解**的更新。

**旧的侧写档案 (JSON):**
{existing_profile}

**最新章节内容 (JSON):**
{new_content}
"""



# === 其他 Prompts ===
SUMMARY_PROMPT_TEMPLATE = """
作为一名专业的故事分析师，你的任务是为以下文本创作一份简洁的、**面向未来**的摘要。

**写作要求:**
1.  **聚焦核心冲突与悬念:** 摘要的核心内容应该是**当前尚未解决的关键冲突、新出现的谜团，以及主角面临的最紧迫的困境**。
2.  **明确角色的下一步动机:** 明确指出主角或关键人物接下来最可能的目标或行动方向。
"""

CHARACTER_IDENTIFICATION_PROMPT = """
你是一位敏锐的文学评论家。请仔细阅读以下故事摘要，并列出其中提及或暗示将要出现的**所有**主要角色的名字。

**故事摘要:**
"{summary_text}"
"""

PROFILE_UPDATE_PROMPT = """
你是一位深刻的心理分析师，任务是更新角色“{character_name}”的侧写档案。

**核心任务:**
1.  **分析当前行为:** 基于角色的旧档案和新章节内容，分析他/她的最新行为和心理变化。
2.  **背景慢速揭示 (仅限主角):** 如果角色是主角，请寻找机会，通过他在电影世界中的内心思考，**极其缓慢且隐晦地**补充一小部分关于他现实世界背景的细节。
3.  **生成新档案:** 输出一份全新的档案，包含对角色**自己的看法**、对**其他角色的看法**、以及对**近期关键事件的理解**的更新。

**旧的侧写档案 (JSON):**
{existing_profile}

**最新章节内容 (JSON):**
{new_content}
"""

# === AI Agent 确认信息 Prompt ===
AGENT_CONFIRMATION_PROMPT = """
你是一个高效的AI行政助理，负责将AI Agent完成的复杂JSON工作，总结成一段简洁、人性化的中文确认信息，以便项目导演追踪进度。

**待总结的内容:**
- **Agent角色:** {agent_role}
- **Agent产出:** ```json
{agent_output}
```

请根据以上内容，生成一段格式为 `[<Agent角色>] 已确认：<总结内容>` 的确认信息。
例如：`[世界架构师] 已确认：新的电影世界《活死人黎明》已规划完毕，包含15个场景。核心情节将围绕主角利用“先知”优势在购物中心求生展开。`
"""

# === 议会 Prompts ===
PARLIAMENT_DIRECTOR_RESPONSE_PROMPT = """
你是一位掌控全局的“故事导演”。在完成了电影《{movie_name}》的篇章后，你召集了所有AI创作团队的成员举行议会。
你已经收集到了来自不同视角的核心问题和复盘。

**当前故事全局摘要:**
{story_summary}

**各成员的发言 (JSON):**
{all_questions}

**你的任务是：**
1.  **深度分析**: 逐一回应每个成员的议题。
2.  **整合与决策**: 综合所有观点，形成一份结构清晰、逻辑严谨的“会议纪要”。
3.  **明确方向**: 在纪要的最后，为下一阶段现实世界主线故事制定明确的**核心目标**、**关键冲突**和**情感基调**。
"""